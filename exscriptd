#!/usr/bin/env python
# Copyright (C) 2010 Samuel Abels.
#
# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License version 2, as
# published by the Free Software Foundation.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program; if not, write to the Free Software
# Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
import sys
from optparse         import OptionParser
from Exscript         import __version__
from Exscriptd.Config import Config

parser = OptionParser(usage = '%prog [options]', version = __version__)
parser.add_option('--domain',
                  dest    = 'domain',
                  metavar = 'DOMAIN',
                  default = None,
                  help    = 'The default domain name')
parser.add_option('--config-dir',
                  dest    = 'config_dir',
                  metavar = 'FILE',
                  help    = '''
The XML config file for the Exscript daemon.
'''.strip())
parser.add_option('--verbose',
                  dest    = 'verbose',
                  action  = 'store_true',
                  default = False,
                  help    = 'Show the conversation with the router')

# Parse options.
options, args = parser.parse_args(sys.argv)
args.pop(0)

if not options.config_dir:
    parser.error('Required option --config-dir not set')

config = Config(options.config_dir)

for daemon in config.init_daemons():
    daemon.run()
